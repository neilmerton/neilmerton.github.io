---
import { navItems, siteConfig } from "../data";

const currentPath = Astro.url.pathname;

// Helper: is this nav item active?
const isActive = (href: string): boolean => {
  if (href === "/") {
    return currentPath === "/";
  }
  return currentPath.startsWith(href);
};
---

<header class="site-header">
  <div class="container container--wide site-header__inner">
    <a
      href="/"
      class="site-header__logo"
      aria-label={`${siteConfig.name} â€” home`}
    >
      <span class="site-header__logo-name">{siteConfig.name}</span>
    </a>

    <nav class="site-nav" aria-label="Main navigation">
      <ul class="site-nav__list" role="list">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class="site-nav__link"
                aria-current={isActive(item.href) ? "page" : undefined}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <button
      class="site-header__menu-btn"
      aria-controls="mobile-menu"
      aria-expanded="false"
      aria-label="Toggle navigation menu"
      id="menu-toggle"
    >
      <span>Menu</span>
      <span class="site-header__menu-btn-bars">
        <span class="site-header__menu-btn-bar" aria-hidden="true"></span>
        <span class="site-header__menu-btn-bar" aria-hidden="true"></span>
        <span class="site-header__menu-btn-bar" aria-hidden="true"></span>
      </span>
    </button>
  </div>

  <nav
    id="mobile-menu"
    class="site-mobile-nav"
    aria-label="Mobile navigation"
    hidden
  >
    <ul class="site-mobile-nav__list" role="list">
      {
        navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class="site-mobile-nav__link"
              aria-current={isActive(item.href) ? "page" : undefined}
            >
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>

<script>
  const toggle = document.getElementById(
    "menu-toggle",
  ) as HTMLButtonElement | null;
  const menu = document.getElementById("mobile-menu") as HTMLElement | null;

  if (toggle && menu) {
    toggle.addEventListener("click", () => {
      const expanded = toggle.getAttribute("aria-expanded") === "true";
      toggle.setAttribute("aria-expanded", String(!expanded));
      menu.hidden = expanded;
    });

    // Close on outside click
    document.addEventListener("click", (e) => {
      if (
        !toggle.contains(e.target as Node) &&
        !menu.contains(e.target as Node)
      ) {
        toggle.setAttribute("aria-expanded", "false");
        menu.hidden = true;
      }
    });

    // Close on Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !menu.hidden) {
        toggle.setAttribute("aria-expanded", "false");
        menu.hidden = true;
        toggle.focus();
      }
    });
  }
</script>

<style>
  .site-header {
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
    background-color: var(--color-bg);
    background-color: color-mix(in srgb, var(--color-bg) 88%, transparent);
    border-block-end: 1px solid var(--color-border-light);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .site-header__inner {
    align-items: center;
    display: flex;
    gap: var(--space-8);
    height: 64px;
    justify-content: space-between;
  }

  .site-header__logo {
    flex-shrink: 0;
    text-decoration: none;
  }

  .site-header__logo-name {
    color: var(--color-text);
    font-family: var(--font-display);
    font-size: var(--text-lg);
    letter-spacing: var(--tracking-tight);
  }

  .site-header__logo:hover .site-header__logo-name {
    color: var(--color-accent);
  }

  .site-nav__list {
    align-items: center;
    display: flex;
    gap: var(--space-2);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .site-nav__link {
    border-radius: var(--radius-md);
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    letter-spacing: var(--tracking-wide);
    padding: var(--space-2) var(--space-3);
    text-decoration: none;
    text-transform: uppercase;
    transition:
      color var(--transition-fast),
      background-color var(--transition-fast);

    &:hover {
      color: var(--color-text);
      background-color: var(--color-bg-subtle);
    }
  }

  .site-nav__link[aria-current="page"] {
    background-color: var(--color-accent-tint);
    color: var(--color-accent);
  }

  .site-header__menu-btn {
    align-items: center;
    background: none;
    border-radius: var(--radius-md);
    border: none;
    color: var(--color-text);
    cursor: pointer;
    display: none;
    flex-direction: row;
    font-family: inherit;
    gap: var(--space-2);
    padding: var(--space-2);
    transition: background-color var(--transition-fast);

    &:hover {
      background-color: var(--color-bg-subtle);
    }
  }

  .site-header__menu-btn-bars {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    height: var(--space-5);
    justify-content: center;
  }

  .site-header__menu-btn-bar {
    background-color: var(--color-text);
    border-radius: var(--radius-pill);
    display: block;
    height: 2px;
    transition:
      transform var(--transition-normal),
      opacity var(--transition-fast);
    width: 22px;
  }

  .site-header__menu-btn[aria-expanded="true"]
    .site-header__menu-btn-bar:nth-child(1) {
    transform: translateY(6px) rotate(45deg);
  }
  .site-header__menu-btn[aria-expanded="true"]
    .site-header__menu-btn-bar:nth-child(2) {
    opacity: 0;
  }
  .site-header__menu-btn[aria-expanded="true"]
    .site-header__menu-btn-bar:nth-child(3) {
    transform: translateY(-6px) rotate(-45deg);
  }

  .site-mobile-nav {
    animation: fadeDown 0.2s ease both;
    border-block-start: 1px solid var(--color-border-light);
    padding-block: var(--space-4);
  }

  .site-mobile-nav__list {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    list-style: none;
    margin: 0;
    padding: 0 var(--content-padding);
  }

  .site-mobile-nav__link {
    border-radius: var(--radius-md);
    color: var(--color-text-muted);
    display: block;
    font-size: var(--text-base);
    letter-spacing: var(--tracking-wide);
    padding: var(--space-3) var(--space-4);
    text-decoration: none;
    text-transform: uppercase;
    transition:
      color var(--transition-fast),
      background-color var(--transition-fast);
  }

  .site-mobile-nav__link:hover,
  .site-mobile-nav__link[aria-current="page"] {
    background-color: var(--color-accent-tint);
    color: var(--color-accent);
  }

  @media (max-width: 640px) {
    .site-nav {
      display: none;
    }

    .site-header__menu-btn {
      display: flex;
    }
  }
</style>
