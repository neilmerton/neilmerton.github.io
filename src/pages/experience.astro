---
import ExperienceFooter from "@components/ExperienceFooter.astro";
import ExperienceProficiencyLegend from "@components/ExperienceProficiencyLegend.astro";
import ExperienceRoleItem from "@components/ExperienceRoleItem.astro";
import ExperienceTechItem from "@components/ExperienceTechItem.astro";
import Layout from "@layouts/Layout.astro";
import { roles, techStack, professionalSummary } from "../data";
import type { TechItem } from "../types";

// Group tech items by category
const groupedTech = techStack.reduce<Record<string, TechItem[]>>(
  (acc, item) => {
    const key = item.category;

    if (!acc[key]) {
      acc[key] = [];
    }

    acc[key].push(item);

    return acc;
  },
  {},
);

const categoryLabels: Record<string, string> = {
  language: "Languages",
  framework: "Frameworks & Libraries",
  tool: "Tools",
  platform: "Platforms",
  other: "Other",
};
---

<Layout
  title="Experience"
  description="Professional experience, technology stack and career history."
>
  <div class="container">
    <header class="page-hero animate-in">
      <span class="page-hero__eyebrow">Career</span>
      <h1 class="page-hero__title">Experience</h1>
      <p class="page-hero__subtitle">{professionalSummary}</p>
    </header>

    <section
      class="exp-section animate-in animate-in--delay-1"
      aria-labelledby="tech-stack-heading"
    >
      <h2 id="tech-stack-heading" class="exp-section__title">
        Technology Stack
      </h2>

      <div class="tech-groups">
        {
          Object.entries(groupedTech).map(([category, items]) => (
            <div class="tech-group">
              <h3 class="tech-group__title">
                {categoryLabels[category] ?? category}
              </h3>
              <ul class="tech-list" role="list">
                {items.map((tech) => (
                  <ExperienceTechItem tech={tech} />
                ))}
              </ul>
            </div>
          ))
        }
      </div>

      <ExperienceProficiencyLegend />
    </section>

    <section class="exp-section" aria-labelledby="roles-heading">
      <h2 id="roles-heading" class="exp-section__title">Work History</h2>

      <ol class="roles" role="list">
        {roles.map((role) => <ExperienceRoleItem role={role} />)}
      </ol>

      <ExperienceFooter />
    </section>
  </div>
</Layout>

<style>
  .exp-section {
    border-bottom: 1px solid var(--color-border-light);
    margin-bottom: var(--space-16);
    padding-bottom: var(--space-16);
  }

  .exp-section:last-child {
    border-bottom: none;
  }

  .exp-section__title {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-10);
  }

  .tech-groups {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: var(--space-8);
    margin-bottom: var(--space-8);
  }

  .tech-group__title {
    color: var(--color-text-muted);
    font-family: var(--font-body);
    font-size: var(--text-xs);
    letter-spacing: var(--tracking-wider);
    margin-bottom: var(--space-4);
    text-transform: uppercase;
  }

  .tech-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .roles {
    display: flex;
    flex-direction: column;
    gap: var(--space-12);
    list-style: none;
    margin: 0;
    padding: 0;
  }
</style>
