---
import RandomSnippet from "@components/RandomSnippet.astro";
import Layout from "@layouts/Layout.astro";
import { getRandomSnippet, siteConfig } from "../data";
import { getCollection } from "astro:content";
import { formatDate } from "../utils";

// Fetch latest blog posts for the home page preview
const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const latestPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<Layout title={siteConfig.title} description={siteConfig.description}>
  <section class="hero container animate-in">
    <p class="hero__eyebrow">Frontend Developer</p>
    <h1 class="hero__name">{siteConfig.name}</h1>
    <p class="hero__tagline">{siteConfig.description}</p>
    <div class="hero__actions">
      <a href="/about" class="btn btn--primary">About me</a>
      <a href="/experience" class="btn btn--secondary">Experience</a>
    </div>
  </section>

  {
    latestPosts.length > 0 && (
      <section class="home-section container animate-in animate-in--delay-1">
        <header class="home-section__header">
          <h2 class="home-section__title">Recent Writing</h2>
          <a href="/blog" class="home-section__more">
            All posts â†’
          </a>
        </header>

        <ol class="post-list" role="list">
          {latestPosts.map((post) => (
            <li class="post-list__item">
              <article>
                <time
                  class="post-list__date"
                  datetime={post.data.pubDate.toISOString()}
                >
                  {formatDate(post.data.pubDate)}
                </time>
                <a href={`/blog/${post.slug}`} class="post-list__link">
                  {post.data.title}
                </a>
              </article>
            </li>
          ))}
        </ol>
      </section>
    )
  }

  <section class="home-section container animate-in animate-in--delay-1">
    <header class="home-section__header">
      <h2 class="home-section__title">Did you know?</h2>
    </header>
    <RandomSnippet :client:visible />
  </section>
</Layout>

<style>
  .hero {
    border-block-end: 1px solid var(--color-border-light);
    padding-block-end: var(--space-24);
    padding-block-start: clamp(var(--space-20), 12vw, var(--space-32));
  }

  .hero__eyebrow {
    color: var(--color-accent);
    font-family: var(--font-body);
    font-size: var(--text-xs);
    letter-spacing: var(--tracking-wider);
    margin-block-end: var(--space-4);
    text-transform: uppercase;
  }

  .hero__name {
    color: var(--color-text);
    font-size: clamp(var(--text-4xl), 8vw, 5rem);
    margin-block-end: var(--space-6);
  }

  .hero__tagline {
    color: var(--color-text-muted);
    font-size: var(--text-lg);
    line-height: var(--leading-relaxed);
    max-width: 50ch;
    margin-block-end: var(--space-10);
  }

  .hero__actions {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .btn {
    align-items: center;
    border-radius: var(--radius-md);
    display: inline-flex;
    font-size: var(--text-sm);
    font-weight: 600;
    justify-content: center;
    letter-spacing: var(--tracking-wide);
    padding: var(--space-3) var(--space-6);
    text-decoration: none;
    text-transform: uppercase;
    transition:
      background-color var(--transition-fast),
      color var(--transition-fast),
      border-color var(--transition-fast);
  }

  .btn--primary {
    background-color: var(--color-accent-bg);
    border: 2px solid var(--color-accent);
    color: #ffffff;

    &:hover {
      background-color: var(--color-accent-hover);
      border-color: var(--color-accent-hover);
      color: #ffffff;
    }
  }

  .btn--secondary {
    background-color: transparent;
    border: 2px solid var(--color-border);
    color: var(--color-text);

    &:hover {
      border-color: var(--color-text-muted);
      color: var(--color-text);
    }
  }

  .home-section {
    padding-block: var(--space-16);
  }

  .home-section + .home-section {
    border-block-start: 1px solid var(--color-border-light);
  }

  .home-section__header {
    align-items: baseline;
    display: flex;
    gap: var(--space-4);
    justify-content: space-between;
    margin-block-end: var(--space-8);
  }

  .home-section__title {
    color: var(--color-text);
    font-size: var(--text-xl);
  }

  .home-section__more {
    color: var(--color-text-muted);
    font-size: var(--text-sm);
    letter-spacing: var(--tracking-wide);
    text-decoration: none;
    white-space: nowrap;

    &:hover {
      color: var(--color-accent);
    }
  }

  .post-list {
    display: flex;
    flex-direction: column;
    gap: 0;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .post-list__item {
    border-block-end: 1px solid var(--color-border-light);
    display: grid;
    grid-template-columns: 1fr;
    padding-block: var(--space-4);

    &:last-child {
      border-block-end: none;
    }
  }

  .post-list__item article {
    align-items: baseline;
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-6);
  }

  .post-list__date {
    color: var(--color-text-subtle);
    flex-shrink: 0;
    font-size: var(--text-sm);
    font-variant-numeric: tabular-nums;
    min-inline-size: 6rem;
  }

  .post-list__link {
    color: var(--color-text);
    font-family: var(--font-display);
    font-size: var(--text-md);
    text-decoration: none;

    &:hover {
      color: var(--color-accent);
      text-decoration: underline;
      text-underline-offset: 4px;
    }
  }
</style>
